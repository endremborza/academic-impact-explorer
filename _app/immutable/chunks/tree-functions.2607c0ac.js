import{S as C,a as I,D as K}from"./constants.8d8a1d0f.js";import{g as z}from"./metric-calculation.caa987db.js";function B(e,n){let i={"ngrok-skip-browser-warning":"1"};return fetch(`${C}/${e.replace("+","%2B")}.json.gz`,{headers:i}).then(t=>t.json().then(l=>n(l)).catch(l=>{console.error("error ar",e,l)}))}function Y(e){B(I,e)}const Z={include:[],exclude:[],limit_n:K,show_top:!0,size_base:"specialization"};function U(e,n){return n==0?{children:{}}:{children:Object.fromEntries(Object.entries(e.children||{}).map(([i,t])=>[i,U(t,n-1)]))}}function $(e,n){const i={};for(let t of Object.keys(e.children||{}))Object.keys(n.children||{}).includes(t)&&(i[t]=$(e.children[t],n.children[t]||{}));return{children:i}}function q(e,n,i,t,l){const d=H(e,n,i,l,t),m=[{totalNodes:1,totalWeight:e.weight}],j={name:"",weight:e.weight,isSelected:!0,children:{},childrenSumWeight:0,totalOffsetOnLevel:{weight:0,rank:0},totalOffsetAmongSiblings:{weight:0,rank:0},scaleEnds:{min:0,max:1,mid:.5}},k=v=>T(v.path.slice(0,-1),j),_=v=>v.path.slice(0,-1).join("-");for(const v of d.slice(1)){let W=0,w=0;const h={},a=[],O=(c,o)=>{const f=k(c),u=k(o);if((f==null?void 0:f.totalOffsetOnLevel.rank)==(u==null?void 0:u.totalOffsetOnLevel.rank)){const L=o.derivedWeight-c.derivedWeight;return L!=0?L:D(c.path)>D(o.path)?-1:1}return((f==null?void 0:f.totalOffsetOnLevel.rank)||0)-((u==null?void 0:u.totalOffsetOnLevel.rank)||0)};for(const c of v){const o=_(c);h[o]=(h[o]||0)+1,M(c,a,O)}for(const c of a){const o=k(c),f=h[_(c)];if((o==null?void 0:o.children)!=null){const u=((o==null?void 0:o.scaleEnds.max)-(o==null?void 0:o.scaleEnds.min))/(f||1),L=D(c.path),N=Object.keys(o.children).length,b=o.scaleEnds.min+(N||0)*u,S=b+u;o.children[L]={name:G(c.path,t,l),weight:c.derivedWeight,isSelected:A(c.path,i),children:{},childrenSumWeight:0,totalOffsetOnLevel:{weight:W,rank:w},totalOffsetAmongSiblings:{weight:o.childrenSumWeight,rank:N},scaleEnds:{min:b,max:S,mid:(S+b)/2}},o.childrenSumWeight+=c.derivedWeight,W+=c.derivedWeight,w+=1}}m.push({totalWeight:W,totalNodes:w})}return{tree:j,meta:m}}function H(e,n,i,t,l){var _,v,W,w;const d=[[{path:[],node:e,derivedWeight:0}]];if(t==null)return d;let m=t.bifurcations[0].resolver_id,j=-1;function k(h){var a;return((a=T(h.slice(0,j+1),e))==null?void 0:a.weight)||0}e:for(let h=0;h<Math.min(n.length,t.bifurcations.length);h++){const a=n[h];let O=a.limit_n;const c=d[h],o=[],f=new Set,u=t.bifurcations[h].attribute_kind,L=Object.keys(l[u]).length,N=a.size_base=="volume"?s=>(s==null?void 0:s.weight)||0:(s,r,p)=>z(s,p,L,u,l,r,t.bifurcations[h].description).specMetric,b=a.show_top?(s,r)=>s.derivedWeight-r.derivedWeight:(s,r)=>r.derivedWeight-s.derivedWeight,S=(s,r)=>{if(a.exclude.includes(r))return;const p=[...s.path,r],g=(s.node.children||{})[r];f.add(p.join("-")),o.push({node:g,path:p,derivedWeight:N(g,r,k(p))}),O--},E=c.filter(s=>A(s.path,i));if(E.length==0)break;d.push(o);for(const s of E)for(const r of Object.keys(((_=T(s.path,i))==null?void 0:_.children)||{}))if(S(s,r),O==0)continue e;for(const s of a.include)for(const r of E)if(Object.hasOwn(((v=r.node)==null?void 0:v.children)||{},s)&&!f.has([...r.path,s].join("-"))&&(S(r,s),O==0))continue e;for(const[s,r]of E.entries()){const p=Math.round(O/(E.length-s));if(p==0)continue;const g=[],R=k(r.path);for(const[x,P]of Object.entries(r.node.children||{})){if(a.exclude.includes(x))continue;const F=[...r.path,x];if(f.has(F.join("-")))continue;const y={node:P,path:F,derivedWeight:N(P,x,R)};g.length<p?M(y,g,b):b(g[0],y)<0&&(g.shift(),M(y,g,b))}g.map(x=>o.push(x)),O-=g.length}((W=t.bifurcations[h+1])==null?void 0:W.resolver_id)!=m&&(m=(w=t.bifurcations[h+1])==null?void 0:w.resolver_id,j=h)}return d}function M(e,n,i){let t=0,l=n.length-1,d,m;for(;t<=l;){if(d=Math.floor((t+l)/2),m=i(n[d],e),m==0)return n.splice(d,0,e);m<0?t=d+1:l=d-1}n.splice(t,0,e)}function T(e,n){let i=n;for(const t of e)if(i=((i==null?void 0:i.children)||{})[t],i===void 0)return i;return i}function A(e,n){return T(e,n)!=null}function V(e){const n=[];for(const[i,t]of Object.entries(e.children||{}))return[i,...V(t)];return n}function G(e,n,i){var d;if(n===void 0)return"Loading...";const t=D(e),l=J(e,i);return((d=n[l][t])==null?void 0:d.name)||"Unknown"}function J(e,n){return n.bifurcations[e.length-1].attribute_kind}const ee=e=>e.split("x");function D(e){return e[e.length-1]}export{Z as D,B as a,$ as b,V as c,q as d,ee as e,T as g,Y as h,M as i,U as p};
